<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable Tracker | Deep Work Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f12;
            color: #ffffff;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(26, 26, 31, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .habit-grid {
            display: grid;
            grid-template-columns: 150px repeat(31, minmax(30px, 1fr));
            overflow-x: auto;
        }

        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }

        .active-tab {
            color: #8b5cf6;
            border-bottom: 2px solid #8b5cf6;
        }

        .pomo-timer {
            font-variant-numeric: tabular-nums;
        }

        .checked-circle {
            background: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body class="min-h-screen">

    <nav class="sticky top-0 z-50 glass-card border-b border-white/10 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <i data-lucide="target" class="text-violet-500"></i>
            <span class="text-xl font-bold tracking-tighter">TIMETABLE TRACKER</span>
        </div>
        <div class="flex gap-8 text-sm font-medium text-gray-400">
            <button onclick="switchTab('tracker')" id="nav-tracker" class="hover:text-white transition active-tab">TRACKER</button>
            <button onclick="switchTab('calendar')" id="nav-calendar" class="hover:text-white transition">CALENDAR</button>
            <button onclick="switchTab('tasks')" id="nav-tasks" class="hover:text-white transition">TASKS</button>
        </div>
        <div class="flex gap-4">
            <button onclick="exportData()" class="p-2 hover:bg-white/5 rounded-lg"><i data-lucide="download" class="w-5 h-5"></i></button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6">
        
        <section id="page-tracker" class="space-y-8">
            <div class="flex flex-col md:flex-row gap-6">
                <div class="glass-card p-6 rounded-2xl w-full md:w-1/3 flex flex-col items-center justify-center">
                    <h3 class="text-gray-400 mb-4 font-semibold uppercase text-xs tracking-widest">Monthly Progress</h3>
                    <div class="relative w-40 h-40">
                        <canvas id="monthlyProgressChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="progress-percent" class="text-3xl font-bold">0%</span>
                        </div>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-2xl flex-grow">
                    <h3 class="text-gray-400 mb-4 font-semibold uppercase text-xs tracking-widest">Completion Trend</h3>
                    <canvas id="trendChart" height="150"></canvas>
                </div>
            </div>

            <div class="glass-card rounded-2xl overflow-hidden">
                <div class="p-6 border-b border-white/5 flex justify-between items-center">
                    <h3 class="font-bold">Habit Matrix - <span id="current-month-name">October</span></h3>
                    <button onclick="addNewHabit()" class="bg-violet-600 hover:bg-violet-700 px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition">
                        <i data-lucide="plus" class="w-4 h-4"></i> Add Habit
                    </button>
                </div>
                <div id="habit-grid-root" class="habit-grid custom-scrollbar p-6 bg-[#131318]">
                    </div>
            </div>
        </section>

        <section id="page-calendar" class="hidden space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 glass-card p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="cal-month-display" class="text-xl font-bold">Month Year</h3>
                        <div class="flex gap-2">
                            <button onclick="changeMonth(-1)" class="p-2 hover:bg-white/5 rounded-lg"><i data-lucide="chevron-left"></i></button>
                            <button onclick="changeMonth(1)" class="p-2 hover:bg-white/5 rounded-lg"><i data-lucide="chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-7 gap-2 text-center text-xs text-gray-500 mb-4">
                        <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                        </div>
                </div>
                <div class="glass-card p-6 rounded-2xl space-y-4">
                    <h3 id="selected-date-label" class="text-violet-400 font-bold">Select a date</h3>
                    <div>
                        <label class="text-xs text-gray-500 uppercase">Daily Journal</label>
                        <textarea id="journal-input" class="w-full h-48 bg-black/30 border border-white/10 rounded-xl p-4 mt-2 focus:border-violet-500 outline-none transition text-sm" placeholder="How was your day?"></textarea>
                    </div>
                    <button onclick="saveJournal()" class="w-full bg-white/5 hover:bg-white/10 py-2 rounded-xl text-sm transition font-semibold">Save Notes</button>
                </div>
            </div>
        </section>

        <section id="page-tasks" class="hidden space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass-card p-8 rounded-3xl">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <i data-lucide="check-circle" class="text-blue-500"></i> Today's Tasks
                    </h2>
                    <div class="flex gap-2 mb-6">
                        <input type="text" id="task-input" class="flex-grow bg-black/40 border border-white/10 rounded-xl px-4 py-3 focus:ring-2 ring-violet-500 outline-none" placeholder="What needs to be done?">
                        <button onclick="addTask()" class="bg-violet-600 px-6 rounded-xl hover:bg-violet-700 transition"><i data-lucide="plus"></i></button>
                    </div>
                    <ul id="task-list" class="space-y-3">
                        </ul>
                </div>

                <div class="space-y-6">
                    <div class="glass-card p-8 rounded-3xl border-l-4 border-violet-600">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold flex items-center gap-2"><i data-lucide="flame" class="text-orange-500"></i> DEEP WORK</h3>
                            <span class="text-xs bg-violet-600/20 text-violet-400 px-2 py-1 rounded">120 MIN</span>
                        </div>
                        <div id="timer-deep" class="pomo-timer text-6xl font-black text-center mb-6">120:00</div>
                        <div class="flex gap-2">
                            <button onclick="toggleTimer('deep', 120)" class="flex-grow bg-white/10 hover:bg-white/20 py-3 rounded-xl transition font-bold uppercase tracking-widest text-xs">Start / Pause</button>
                            <button onclick="resetTimer('deep', 120)" class="px-4 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl transition"><i data-lucide="rotate-ccw"></i></button>
                        </div>
                    </div>
                    <div class="glass-card p-8 rounded-3xl border-l-4 border-blue-500">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold flex items-center gap-2"><i data-lucide="coffee" class="text-blue-400"></i> BREAK</h3>
                            <span class="text-xs bg-blue-600/20 text-blue-400 px-2 py-1 rounded">15 MIN</span>
                        </div>
                        <div id="timer-break" class="pomo-timer text-6xl font-black text-center mb-6">15:00</div>
                        <div class="flex gap-2">
                            <button onclick="toggleTimer('break', 15)" class="flex-grow bg-white/10 hover:bg-white/20 py-3 rounded-xl transition font-bold uppercase tracking-widest text-xs">Start / Pause</button>
                            <button onclick="resetTimer('break', 15)" class="px-4 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl transition"><i data-lucide="rotate-ccw"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- DATA STATE ---
        let state = JSON.parse(localStorage.getItem('timetable_data')) || {
            habits: ["Wake up (2-4 AM)", "Workout", "Study 18 Hours", "No Porn", "No Games"],
            completions: {}, // format: "2023-10-24": ["Habit1", "Habit2"]
            journals: {},
            tasks: [],
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };

        function saveState() {
            localStorage.setItem('timetable_data', JSON.stringify(state));
            updateCharts();
        }

        // --- NAVIGATION ---
        function switchTab(tabId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            
            document.getElementById('page-' + tabId).classList.remove('hidden');
            document.getElementById('nav-' + tabId).classList.add('active-tab');
            
            if(tabId === 'tracker') renderTracker();
            if(tabId === 'calendar') renderCalendar();
            if(tabId === 'tasks') renderTasks();
        }

        // --- TRACKER LOGIC ---
        function renderTracker() {
            const root = document.getElementById('habit-grid-root');
            const daysInMonth = new Date(state.currentYear, state.currentMonth + 1, 0).getDate();
            document.getElementById('current-month-name').innerText = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(new Date(state.currentYear, state.currentMonth));

            let html = `<div class="font-bold text-gray-500 text-xs">HABIT</div>`;
            for (let i = 1; i <= daysInMonth; i++) {
                html += `<div class="text-center text-xs font-bold text-gray-600">${i}</div>`;
            }

            state.habits.forEach(habit => {
                html += `<div class="py-2 text-sm font-medium border-b border-white/5 truncate pr-4">${habit}</div>`;
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${i}`;
                    const isDone = state.completions[dateKey]?.includes(habit);
                    html += `
                        <div class="flex items-center justify-center border-b border-white/5 py-2">
                            <button onclick="toggleHabit('${dateKey}', '${habit}')" 
                                class="w-5 h-5 rounded-full border border-white/20 transition ${isDone ? 'checked-circle' : 'hover:border-violet-500'}">
                            </button>
                        </div>`;
                }
            });
            root.innerHTML = html;
        }

        function toggleHabit(dateKey, habit) {
            if (!state.completions[dateKey]) state.completions[dateKey] = [];
            const index = state.completions[dateKey].indexOf(habit);
            if (index > -1) state.completions[dateKey].splice(index, 1);
            else state.completions[dateKey].push(habit);
            saveState();
            renderTracker();
        }

        function addNewHabit() {
            const name = prompt("Enter habit name:");
            if (name) {
                state.habits.push(name);
                saveState();
                renderTracker();
            }
        }

        // --- CALENDAR LOGIC ---
        let selectedDate = null;

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const firstDay = new Date(state.currentYear, state.currentMonth, 1).getDay();
            const daysInMonth = new Date(state.currentYear, state.currentMonth + 1, 0).getDate();
            
            document.getElementById('cal-month-display').innerText = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(new Date(state.currentYear, state.currentMonth))} ${state.currentYear}`;
            
            let html = '';
            for (let i = 0; i < firstDay; i++) html += '<div></div>';
            
            for (let i = 1; i <= daysInMonth; i++) {
                const dateKey = `${state.currentYear}-${state.currentMonth}-${i}`;
                const hasNote = state.journals[dateKey] ? 'border-t-2 border-violet-500' : '';
                html += `
                    <button onclick="selectDate('${dateKey}')" class="aspect-square glass-card rounded-lg flex flex-col items-center justify-center hover:bg-violet-600/20 transition ${hasNote}">
                        <span class="text-sm">${i}</span>
                    </button>`;
            }
            grid.innerHTML = html;
        }

        function selectDate(key) {
            selectedDate = key;
            document.getElementById('selected-date-label').innerText = key;
            document.getElementById('journal-input').value = state.journals[key] || "";
        }

        function saveJournal() {
            if (!selectedDate) return alert("Select a date first");
            state.journals[selectedDate] = document.getElementById('journal-input').value;
            saveState();
            renderCalendar();
        }

        function changeMonth(dir) {
            state.currentMonth += dir;
            if (state.currentMonth > 11) { state.currentMonth = 0; state.currentYear++; }
            if (state.currentMonth < 0) { state.currentMonth = 11; state.currentYear--; }
            renderCalendar();
            renderTracker();
        }

        // --- TASKS & POMODORO ---
        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = state.tasks.map((t, i) => `
                <li class="flex items-center gap-4 bg-white/5 p-4 rounded-xl group">
                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${i})" class="w-5 h-5 rounded border-white/20">
                    <span class="flex-grow ${t.done ? 'line-through text-gray-500' : ''}">${t.text}</span>
                    <button onclick="deleteTask(${i})" class="opacity-0 group-hover:opacity-100 text-red-500 transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </li>
            `).join('');
            lucide.createIcons();
        }

        function addTask() {
            const input = document.getElementById('task-input');
            if (input.value) {
                state.tasks.push({ text: input.value, done: false });
                input.value = '';
                saveState();
                renderTasks();
            }
        }

        function toggleTask(i) {
            state.tasks[i].done = !state.tasks[i].done;
            saveState();
            renderTasks();
        }

        function deleteTask(i) {
            state.tasks.splice(i, 1);
            saveState();
            renderTasks();
        }

        // Timer Logic
        let intervals = { deep: null, break: null };
        let times = { deep: 120 * 60, break: 15 * 60 };

        function toggleTimer(type, defaultMin) {
            if (intervals[type]) {
                clearInterval(intervals[type]);
                intervals[type] = null;
            } else {
                intervals[type] = setInterval(() => {
                    times[type]--;
                    updateTimerUI(type);
                    if (times[type] <= 0) {
                        clearInterval(intervals[type]);
                        new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();
                        alert(`${type.toUpperCase()} Finished!`);
                    }
                }, 1000);
            }
        }

        function resetTimer(type, min) {
            clearInterval(intervals[type]);
            intervals[type] = null;
            times[type] = min * 60;
            updateTimerUI(type);
        }

        function updateTimerUI(type) {
            const m = Math.floor(times[type] / 60);
            const s = times[type] % 60;
            document.getElementById(`timer-${type}`).innerText = `${m}:${s.toString().padStart(2, '0')}`;
        }

        // --- CHARTS ---
        let trendChart, progressChart;

        function updateCharts() {
            const daysInMonth = new Date(state.currentYear, state.currentMonth + 1, 0).getDate();
            const labels = Array.from({length: daysInMonth}, (_, i) => i + 1);
            const dataPoints = labels.map(day => {
                const key = `${state.currentYear}-${state.currentMonth}-${day}`;
                const count = state.completions[key]?.length || 0;
                return (count / state.habits.length) * 100;
            });

            const avgTotal = dataPoints.reduce((a,b) => a+b, 0) / daysInMonth;
            document.getElementById('progress-percent').innerText = Math.round(avgTotal) + '%';

            if (trendChart) trendChart.destroy();
            trendChart = new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Completion %',
                        data: dataPoints,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            if (progressChart) progressChart.destroy();
            progressChart = new Chart(document.getElementById('monthlyProgressChart'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [avgTotal, 100 - avgTotal],
                        backgroundColor: ['#3b82f6', '#1a1a1f'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '80%', plugins: { tooltip: { enabled: false } } }
            });
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "timetable_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // Initialize
        lucide.createIcons();
        renderTracker();
        updateCharts();

    </script>
</body>
</html>
